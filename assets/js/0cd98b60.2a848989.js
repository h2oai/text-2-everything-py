"use strict";(globalThis.webpackChunksite=globalThis.webpackChunksite||[]).push([[101],{3024:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"guides/executions","title":"Executions","description":"Execute SQL queries against database connectors and leverage execution caching.","source":"@site/docs/guides/executions.md","sourceDirName":"guides","slug":"/guides/executions","permalink":"/text-2-everything-py/guides/executions","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Executions"},"sidebar":"defaultSidebar","previous":{"title":"Chat Presets","permalink":"/text-2-everything-py/guides/chat_presets"},"next":{"title":"Feedback","permalink":"/text-2-everything-py/guides/feedback"}}');var c=t(4848),s=t(8453);const r={title:"Executions"},a=void 0,o={},l=[{value:"Basic Operations",id:"basic-operations",level:2},{value:"Execute SQL from Chat Message",id:"execute-sql-from-chat-message",level:3},{value:"Execute SQL Query Directly",id:"execute-sql-query-directly",level:3},{value:"Execute with Session Context",id:"execute-with-session-context",level:3},{value:"Get Execution Details",id:"get-execution-details",level:3},{value:"List Executions",id:"list-executions",level:3},{value:"Execution Cache Lookup",id:"execution-cache-lookup",level:2},{value:"Basic Cache Lookup",id:"basic-cache-lookup",level:3},{value:"Advanced Cache Lookup",id:"advanced-cache-lookup",level:3},{value:"Cache Lookup Parameters",id:"cache-lookup-parameters",level:3},{value:"Using Cache Results",id:"using-cache-results",level:3},{value:"Integrating Cache with Chat",id:"integrating-cache-with-chat",level:2},{value:"Performance Optimization",id:"performance-optimization",level:2},{value:"Cache-First Pattern",id:"cache-first-pattern",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Common Patterns",id:"common-patterns",level:2},{value:"Daily Report Caching",id:"daily-report-caching",level:3},{value:"Query Suggestion from Cache",id:"query-suggestion-from-cache",level:3}];function u(e){const n={code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.p,{children:"Execute SQL queries against database connectors and leverage execution caching."}),"\n",(0,c.jsx)(n.h2,{id:"basic-operations",children:"Basic Operations"}),"\n",(0,c.jsx)(n.h3,{id:"execute-sql-from-chat-message",children:"Execute SQL from Chat Message"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-python",children:'from text2everything_sdk import Text2EverythingClient\n\nclient = Text2EverythingClient(\n    base_url="https://...",\n    access_token="...",\n    workspace_name="workspaces/dev"\n)\n\n# Execute SQL from a chat message\nresult = client.executions.execute_from_chat(\n    project_id="proj-123",\n    connector_id="conn-456",\n    chat_message_id="msg-789"\n)\n\nprint(f"Execution time: {result.execution_time_ms}ms")\nprint(f"Rows returned: {len(result.result.get(\'data\', []))}")\nprint(f"Result: {result.result}")\n'})}),"\n",(0,c.jsx)(n.h3,{id:"execute-sql-query-directly",children:"Execute SQL Query Directly"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-python",children:'# Execute a SQL query directly\nresult = client.executions.execute_query(\n    project_id="proj-123",\n    connector_id="conn-456",\n    sql_query="SELECT * FROM users WHERE active = true LIMIT 10"\n)\n\nprint(f"Query executed in {result.execution_time_ms}ms")\nprint(f"Found {len(result.result.get(\'data\', []))} rows")\n'})}),"\n",(0,c.jsx)(n.h3,{id:"execute-with-session-context",children:"Execute with Session Context"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-python",children:'# Include chat session for context\nresult = client.executions.execute_query(\n    project_id="proj-123",\n    connector_id="conn-456",\n    sql_query="SELECT COUNT(*) FROM orders WHERE status = \'pending\'",\n    chat_session_id="session-abc"\n)\n'})}),"\n",(0,c.jsx)(n.h3,{id:"get-execution-details",children:"Get Execution Details"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-python",children:'# Retrieve execution by ID\nexecution = client.executions.get(\n    project_id="proj-123",\n    execution_id="exec-456"\n)\n\nprint(f"Query: {execution.sql_query}")\nprint(f"Time: {execution.execution_time_ms}ms")\nprint(f"Success: {execution.successful}")\n'})}),"\n",(0,c.jsx)(n.h3,{id:"list-executions",children:"List Executions"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-python",children:'# List all executions\nexecutions = client.executions.list(project_id="proj-123")\n\nfor execution in executions:\n    status = "\u2713" if execution.successful else "\u2717"\n    print(f"{status} ID: {execution.id}, Time: {execution.execution_time_ms}ms")\n\n# List with filters\nexecutions = client.executions.list(\n    project_id="proj-123",\n    connector_id="conn-456",\n    limit=50,\n    skip=0\n)\n\n# Filter by chat message\nexecutions = client.executions.list(\n    project_id="proj-123",\n    chat_message_id="msg-789"\n)\n\n# Search executions\nexecutions = client.executions.list(\n    project_id="proj-123",\n    q="customers"\n)\n'})}),"\n",(0,c.jsx)(n.h2,{id:"execution-cache-lookup",children:"Execution Cache Lookup"}),"\n",(0,c.jsx)(n.p,{children:"The execution cache allows you to find and reuse results from previously executed SQL queries that are semantically similar to your current query. This can significantly improve performance and reduce database load."}),"\n",(0,c.jsx)(n.h3,{id:"basic-cache-lookup",children:"Basic Cache Lookup"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-python",children:'# Look for similar executions\nresult = client.chat.execution_cache_lookup(\n    project_id="proj-123",\n    user_query="How many active users do we have?",\n    connector_id="conn-456"\n)\n\nif result.cache_hit:\n    print(f"Found {len(result.matches)} similar executions!")\n    for match in result.matches:\n        print(f"Similarity: {match.similarity_score:.2f}")\n        print(f"SQL: {match.execution.get(\'sql_query\')}")\n        print(f"Results: {match.execution.get(\'result\')}")\nelse:\n    print("No similar executions found in cache")\n'})}),"\n",(0,c.jsx)(n.h3,{id:"advanced-cache-lookup",children:"Advanced Cache Lookup"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-python",children:'# Fine-tune cache lookup with parameters\nresult = client.chat.execution_cache_lookup(\n    project_id="proj-123",\n    user_query="Show me top customers by revenue",\n    connector_id="conn-456",\n    max_age_days=7,              # Only consider executions from last 7 days\n    similarity_threshold=0.8,     # Higher threshold for more similar matches\n    limit=100,                    # Check up to 100 candidates\n    top_n=3,                      # Return top 3 matches\n    only_positive_feedback=True   # Only return executions with positive feedback\n)\n\nif result.cache_hit:\n    print(f"Found {len(result.matches)} highly similar executions")\n    \n    for i, match in enumerate(result.matches, 1):\n        print(f"\\nMatch {i}:")\n        print(f"  Similarity: {match.similarity_score:.2f}")\n        print(f"  SQL: {match.execution.get(\'sql_query\')}")\n        print(f"  Executed: {match.execution.get(\'created_at\')}")\n        print(f"  Time: {match.execution.get(\'execution_time_ms\')}ms")\n        \n        if match.has_feedback:\n            feedback_icon = "\ud83d\udc4d" if match.feedback_is_positive else "\ud83d\udc4e"\n            print(f"  Feedback: {feedback_icon}")\n'})}),"\n",(0,c.jsx)(n.h3,{id:"cache-lookup-parameters",children:"Cache Lookup Parameters"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.strong,{children:"max_age_days"}),": Filter executions by age (default: 30 days)"]}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"Use shorter periods for fast-changing data"}),"\n",(0,c.jsx)(n.li,{children:"Use longer periods for stable datasets"}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.strong,{children:"similarity_threshold"}),": Minimum similarity score 0.0-1.0 (default: 0.65)"]}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"Higher values (0.8+): Only very similar queries"}),"\n",(0,c.jsx)(n.li,{children:"Medium values (0.6-0.8): Balanced similarity"}),"\n",(0,c.jsx)(n.li,{children:"Lower values (0.4-0.6): Broader matches"}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.strong,{children:"limit"}),": Number of candidates to check (default: 50)"]}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"Higher values: More thorough search, slower"}),"\n",(0,c.jsx)(n.li,{children:"Lower values: Faster search, might miss matches"}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.strong,{children:"top_n"}),": Number of matches to return (default: 5)"]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.strong,{children:"only_positive_feedback"}),": Filter by feedback (default: False)"]}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"True: Only executions users marked as helpful"}),"\n",(0,c.jsx)(n.li,{children:"False: All executions regardless of feedback"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(n.h3,{id:"using-cache-results",children:"Using Cache Results"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-python",children:'# Lookup cache before executing new query\ncache_result = client.chat.execution_cache_lookup(\n    project_id="proj-123",\n    user_query="Count active customers",\n    connector_id="conn-456",\n    similarity_threshold=0.9,  # Very strict matching\n    only_positive_feedback=True\n)\n\nif cache_result.cache_hit and cache_result.matches:\n    # Use cached result\n    best_match = cache_result.matches[0]\n    print("Using cached result:")\n    print(f"SQL: {best_match.execution[\'sql_query\']}")\n    print(f"Result: {best_match.execution[\'result\']}")\n    print(f"Age: {best_match.execution[\'created_at\']}")\nelse:\n    # Execute new query\n    result = client.executions.execute_query(\n        project_id="proj-123",\n        connector_id="conn-456",\n        sql_query="SELECT COUNT(*) FROM customers WHERE status = \'active\'"\n    )\n    print("Executed new query:")\n    print(f"Result: {result.result}")\n'})}),"\n",(0,c.jsx)(n.h2,{id:"integrating-cache-with-chat",children:"Integrating Cache with Chat"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-python",children:'# Complete workflow: Cache lookup + Chat + Execution\nuser_query = "Show me monthly sales trends"\n\n# 1. Check cache first\ncache_result = client.chat.execution_cache_lookup(\n    project_id="proj-123",\n    user_query=user_query,\n    connector_id="conn-456",\n    max_age_days=1,  # Today\'s queries only\n    similarity_threshold=0.85\n)\n\nif cache_result.cache_hit:\n    # Use cached result\n    print("Using cached execution")\n    cached_data = cache_result.matches[0].execution[\'result\']\nelse:\n    # No cache hit - generate and execute SQL\n    print("Generating new SQL...")\n    \n    # Create session\n    session = client.chat_sessions.create(project_id="proj-123")\n    \n    # Generate and execute\n    answer = client.chat.chat_to_answer(\n        project_id="proj-123",\n        chat_session_id=session.id,\n        query=user_query,\n        connector_id="conn-456"\n    )\n    \n    if answer.execution_result:\n        print(f"Executed in {answer.execution_result.execution_time_ms}ms")\n        result_data = answer.execution_result.result\n'})}),"\n",(0,c.jsx)(n.h2,{id:"performance-optimization",children:"Performance Optimization"}),"\n",(0,c.jsx)(n.h3,{id:"cache-first-pattern",children:"Cache-First Pattern"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-python",children:'def get_query_result(client, project_id, connector_id, user_query):\n    """\n    Attempt to use cache first, fall back to execution.\n    """\n    # Try cache with strict matching\n    cache_result = client.chat.execution_cache_lookup(\n        project_id=project_id,\n        user_query=user_query,\n        connector_id=connector_id,\n        similarity_threshold=0.85,\n        max_age_days=1,\n        only_positive_feedback=True\n    )\n    \n    if cache_result.cache_hit and cache_result.matches:\n        return {\n            "source": "cache",\n            "data": cache_result.matches[0].execution[\'result\'],\n            "cached_sql": cache_result.matches[0].execution[\'sql_query\']\n        }\n    \n    # No cache hit - execute query\n    session = client.chat_sessions.create(project_id=project_id)\n    answer = client.chat.chat_to_answer(\n        project_id=project_id,\n        chat_session_id=session.id,\n        query=user_query,\n        connector_id=connector_id\n    )\n    \n    return {\n        "source": "execution",\n        "data": answer.execution_result.result if answer.execution_result else None,\n        "sql": answer.sql_query\n    }\n\n# Usage\nresult = get_query_result(\n    client, \n    "proj-123", \n    "conn-456", \n    "What are our top 10 products?"\n)\n\nprint(f"Result from: {result[\'source\']}")\nprint(f"Data: {result[\'data\']}")\n'})}),"\n",(0,c.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"Cache Strategy"})}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"Use cache lookup for frequently asked questions"}),"\n",(0,c.jsxs)(n.li,{children:["Set appropriate ",(0,c.jsx)(n.code,{children:"max_age_days"})," based on data volatility"]}),"\n",(0,c.jsxs)(n.li,{children:["Use ",(0,c.jsx)(n.code,{children:"only_positive_feedback=True"})," for production queries"]}),"\n",(0,c.jsx)(n.li,{children:"Monitor cache hit rates to optimize thresholds"}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"Performance"})}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"Cache lookups are fast - always try cache first"}),"\n",(0,c.jsxs)(n.li,{children:["Adjust ",(0,c.jsx)(n.code,{children:"similarity_threshold"})," based on query precision needs"]}),"\n",(0,c.jsxs)(n.li,{children:["Use shorter ",(0,c.jsx)(n.code,{children:"max_age_days"})," for fast-changing data"]}),"\n",(0,c.jsxs)(n.li,{children:["Set ",(0,c.jsx)(n.code,{children:"limit"})," appropriately (50-100 is usually sufficient)"]}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"Feedback Integration"})}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"Add positive feedback to good executions to improve cache quality"}),"\n",(0,c.jsx)(n.li,{children:"Filter cache results by positive feedback for reliable answers"}),"\n",(0,c.jsx)(n.li,{children:"Review negative feedback to identify problematic queries"}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"Error Handling"})}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["Always check ",(0,c.jsx)(n.code,{children:"result.cache_hit"})," before using matches"]}),"\n",(0,c.jsx)(n.li,{children:"Handle empty matches list gracefully"}),"\n",(0,c.jsx)(n.li,{children:"Fall back to execution if cache misses"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"common-patterns",children:"Common Patterns"}),"\n",(0,c.jsx)(n.h3,{id:"daily-report-caching",children:"Daily Report Caching"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-python",children:'# Check for today\'s report first\ncache_result = client.chat.execution_cache_lookup(\n    project_id="proj-123",\n    user_query="Generate daily sales report",\n    connector_id="conn-456",\n    max_age_days=1,  # Today only\n    similarity_threshold=0.95  # Exact match\n)\n\nif cache_result.cache_hit:\n    print("Using today\'s cached report")\n    report_data = cache_result.matches[0].execution[\'result\']\nelse:\n    print("Generating fresh report")\n    # Execute new query...\n'})}),"\n",(0,c.jsx)(n.h3,{id:"query-suggestion-from-cache",children:"Query Suggestion from Cache"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-python",children:'# Find similar queries users have run\ncache_result = client.chat.execution_cache_lookup(\n    project_id="proj-123",\n    user_query="customer analytics",\n    connector_id="conn-456",\n    similarity_threshold=0.5,  # Broader match for suggestions\n    top_n=10,\n    only_positive_feedback=True\n)\n\nif cache_result.matches:\n    print("Similar queries:")\n    for match in cache_result.matches:\n        print(f"  \u2022 {match.execution.get(\'user_query\', \'N/A\')}")\n        print(f"    SQL: {match.execution[\'sql_query\']}")\n'})})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(u,{...e})}):u(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>a});var i=t(6540);const c={},s=i.createContext(c);function r(e){const n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:r(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);
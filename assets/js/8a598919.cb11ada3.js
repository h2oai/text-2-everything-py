"use strict";(globalThis.webpackChunksite=globalThis.webpackChunksite||[]).push([[291],{4666:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>u,frontMatter:()=>r,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"how-to/bulk_operations","title":"Bulk Operations","description":"Create many items efficiently. If bulk fails, fall back to per-item creates.","source":"@site/docs/how-to/bulk_operations.md","sourceDirName":"how-to","slug":"/how-to/bulk_operations","permalink":"/text-2-everything-py/how-to/bulk_operations","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Bulk Operations"},"sidebar":"defaultSidebar","previous":{"title":"Concurrency & Performance","permalink":"/text-2-everything-py/guides/concurrency"},"next":{"title":"Jupyter Usage","permalink":"/text-2-everything-py/how-to/jupyter"}}');var l=t(4848),a=t(8453);const r={title:"Bulk Operations"},i=void 0,c={},o=[{value:"Bulk Operations with Split Schemas",id:"bulk-operations-with-split-schemas",level:2},{value:"Understanding Result Flattening",id:"understanding-result-flattening",level:3},{value:"Handling Split Results",id:"handling-split-results",level:3},{value:"Parallel Bulk Operations",id:"parallel-bulk-operations",level:3},{value:"Best Practices",id:"best-practices",level:3},{value:"Fallback Pattern",id:"fallback-pattern",level:2}];function p(e){const n={code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,a.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.p,{children:"Create many items efficiently. If bulk fails, fall back to per-item creates."}),"\n",(0,l.jsx)(n.p,{children:"Contexts bulk:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'items = [{"name": "Rule 1", "content": "..."}, {"name": "Rule 2", "content": "..."}]\ncreated = client.contexts.bulk_create(project.id, items)\n'})}),"\n",(0,l.jsx)(n.p,{children:"Schema metadata bulk with validation:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'schemas = [\n  {"name": "t1", "schema_data": {"table": {"name": "t1", "columns": []}}},\n  {"name": "dim1", "schema_data": {"table": {"dimension": {"name": "d", "content": {}}}}},\n]\ncreated = client.schema_metadata.bulk_create(project.id, schemas, validate=True)\n'})}),"\n",(0,l.jsx)(n.p,{children:"Golden examples bulk:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'examples = [\n  {"user_query": "How many users?", "sql_query": "SELECT COUNT(*) FROM users;"},\n  {"user_query": "Active users?", "sql_query": "SELECT COUNT(*) FROM users WHERE active=true;"},\n]\ncreated = client.golden_examples.bulk_create(project.id, examples)\n'})}),"\n",(0,l.jsx)(n.h2,{id:"bulk-operations-with-split-schemas",children:"Bulk Operations with Split Schemas"}),"\n",(0,l.jsxs)(n.p,{children:["When creating schema metadata with ",(0,l.jsx)(n.code,{children:"bulk_create()"}),", tables with >8 columns are automatically split into multiple parts. The results are ",(0,l.jsx)(n.strong,{children:"flattened"}),", meaning you get all parts from all schemas in a single list."]}),"\n",(0,l.jsx)(n.h3,{id:"understanding-result-flattening",children:"Understanding Result Flattening"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'schemas = [\n    # Small schema (4 columns) - returns 1 part\n    {\n        "name": "Small Table",\n        "schema_data": {\n            "table": {\n                "name": "users",\n                "columns": [\n                    {"name": "id", "type": "INTEGER"},\n                    {"name": "email", "type": "VARCHAR(255)"},\n                    {"name": "name", "type": "VARCHAR(100)"},\n                    {"name": "status", "type": "VARCHAR(50)"},\n                ]\n            }\n        }\n    },\n    # Large schema (10 columns) - returns 2 parts\n    {\n        "name": "Large Table",\n        "schema_data": {\n            "table": {\n                "name": "customers",\n                "columns": [\n                    {"name": f"col_{i}", "type": "VARCHAR(100)"}\n                    for i in range(10)\n                ]\n            }\n        }\n    }\n]\n\n# Create both schemas\nresults = client.schema_metadata.bulk_create(project.id, schemas)\n\n# Results are flattened: 1 part + 2 parts = 3 total items\nprint(f"Input: {len(schemas)} schemas")\nprint(f"Output: {len(results)} schema parts")  # Will be 3\n\n# Identify split vs non-split schemas\nfor result in results:\n    if result.split_group_id:\n        print(f"Split part {result.split_index}/{result.total_splits}: {result.name}")\n    else:\n        print(f"Single schema: {result.name}")\n'})}),"\n",(0,l.jsx)(n.h3,{id:"handling-split-results",children:"Handling Split Results"}),"\n",(0,l.jsxs)(n.p,{children:["Group results by ",(0,l.jsx)(n.code,{children:"split_group_id"})," to identify which parts belong together:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'# Organize results by split groups\nsplit_groups = {}\nsingle_schemas = []\n\nfor result in results:\n    if result.split_group_id:\n        if result.split_group_id not in split_groups:\n            split_groups[result.split_group_id] = []\n        split_groups[result.split_group_id].append(result)\n    else:\n        single_schemas.append(result)\n\nprint(f"Created {len(single_schemas)} single schemas")\nprint(f"Created {len(split_groups)} split groups")\n'})}),"\n",(0,l.jsx)(n.h3,{id:"parallel-bulk-operations",children:"Parallel Bulk Operations"}),"\n",(0,l.jsx)(n.p,{children:"For large batches, use parallel processing with split-aware handling:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'# Enable parallel processing (default)\nresults = client.schema_metadata.bulk_create(\n    project.id,\n    schemas,\n    parallel=True,\n    max_workers=8  # Control concurrency\n)\n\n# Results are still flattened - handle them the same way\nsplit_count = sum(1 for r in results if r.split_group_id)\nsingle_count = len(results) - split_count\nprint(f"Created {single_count} single + {split_count} split parts")\n'})}),"\n",(0,l.jsx)(n.h3,{id:"best-practices",children:"Best Practices"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Expect more results than inputs"})," - large schemas create multiple parts"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsxs)(n.strong,{children:["Group by ",(0,l.jsx)(n.code,{children:"split_group_id"})]})," - to identify which parts belong together"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Delete responsibly"})," - deleting one part cascades to entire split group"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Use parallel mode"})," - significantly faster for large batches"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"fallback-pattern",children:"Fallback Pattern"}),"\n",(0,l.jsx)(n.p,{children:"Fallback helper:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'def create_with_fallback(client, project_id, data_list, resource_name):\n    try:\n        if resource_name == "contexts":\n            return client.contexts.bulk_create(project_id, data_list)\n        elif resource_name == "schema_metadata":\n            return client.schema_metadata.bulk_create(project_id, data_list)\n        elif resource_name == "golden_examples":\n            return client.golden_examples.bulk_create(project_id, data_list)\n    except Exception:\n        results = []\n        for item_data in data_list:\n            try:\n                if resource_name == "contexts":\n                    results.append(client.contexts.create(project_id=project_id, **item_data))\n                elif resource_name == "schema_metadata":\n                    results.append(client.schema_metadata.create(project_id=project_id, **item_data))\n                elif resource_name == "golden_examples":\n                    results.append(client.golden_examples.create(project_id=project_id, **item_data))\n            except Exception:\n                pass\n        return results\n'})})]})}function u(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(p,{...e})}):p(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>i});var s=t(6540);const l={},a=s.createContext(l);function r(e){const n=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:r(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);